services:
  voice-gateway:
    build: .
    container_name: voice-gateway
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - DATA_DIR=/app/data
    volumes:
      # Wake word files
      - ./wakewords:/app/wakewords:ro
      # Persist SQLite database
      - ./data:/app/data
    # Option A: PulseAudio (recommended for most setups)
    # Uncomment and adjust UID if needed
    # volumes:
    #   - /run/user/1000/pulse:/run/user/1000/pulse
    #   - ~/.config/pulse/cookie:/root/.config/pulse/cookie:ro
    # environment:
    #   - PULSE_SERVER=unix:/run/user/1000/pulse/native

    # Option B: Direct ALSA access
    devices:
      - /dev/snd:/dev/snd
    group_add:
      - audio

  # Example: Include SillyTavern in same compose file
  # sillytavern:
  #   image: ghcr.io/sillytavern/sillytavern:latest
  #   container_name: sillytavern
  #   ports:
  #     - "8000:8000"
  #   volumes:
  #     - ./st-config:/home/node/app/config
  #     - ./st-data:/home/node/app/data
